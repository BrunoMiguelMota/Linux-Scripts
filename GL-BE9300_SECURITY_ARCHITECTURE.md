# GL-BE9300 Security Architecture

## Network Topology

```
                                    Internet
                                        â”‚
                                        â”‚
                                        â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚        WAN Interface              â”‚
                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
                    â”‚  â”‚   Firewall Rules (strict)   â”‚  â”‚
                    â”‚  â”‚   - Drop invalid packets    â”‚  â”‚
                    â”‚  â”‚   - SYN flood protection    â”‚  â”‚
                    â”‚  â”‚   - Only allow WireGuard    â”‚  â”‚
                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                                       â”‚
                    â–¼                                       â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   BanIP Module      â”‚            â”‚ DNS-over-HTTPS      â”‚
        â”‚                     â”‚            â”‚                     â”‚
        â”‚ â€¢ Firehol feeds     â”‚            â”‚ â€¢ Cloudflare DoH    â”‚
        â”‚ â€¢ Spamhaus          â”‚            â”‚ â€¢ Quad9 DoH         â”‚
        â”‚ â€¢ Talos Intel       â”‚            â”‚ â€¢ Local proxy       â”‚
        â”‚ â€¢ SSH protection    â”‚            â”‚   (127.0.0.1:5053)  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                                       â”‚
                    â–¼                                       â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   Adblock Module    â”‚            â”‚  WireGuard VPN      â”‚
        â”‚                     â”‚            â”‚                     â”‚
        â”‚ â€¢ AdAway lists      â”‚            â”‚ â€¢ Port: 51820/UDP   â”‚
        â”‚ â€¢ OISD              â”‚            â”‚ â€¢ Network: 10.0.0.0 â”‚
        â”‚ â€¢ Steven Black      â”‚            â”‚ â€¢ Encryption: ChaChaâ”‚
        â”‚ â€¢ Safe search       â”‚            â”‚ â€¢ NAT enabled       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚      GL-BE9300 Router Core       â”‚
                    â”‚                                   â”‚
                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
                    â”‚  â”‚   LAN Interface             â”‚  â”‚
                    â”‚  â”‚   - 192.168.8.1/24          â”‚  â”‚
                    â”‚  â”‚   - DHCP server             â”‚  â”‚
                    â”‚  â”‚   - SSH (key-only)          â”‚  â”‚
                    â”‚  â”‚   - HTTPS web UI            â”‚  â”‚
                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                               â”‚                               â”‚
        â–¼                               â–¼                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2.4GHz WiFi  â”‚           â”‚    5GHz WiFi      â”‚           â”‚  6GHz WiFi    â”‚
â”‚               â”‚           â”‚                   â”‚           â”‚               â”‚
â”‚ â€¢ WPA3-SAE    â”‚           â”‚ â€¢ WPA3-SAE        â”‚           â”‚ â€¢ WPA3-SAE    â”‚
â”‚ â€¢ IEEE 802.11wâ”‚           â”‚ â€¢ IEEE 802.11w    â”‚           â”‚ â€¢ IEEE 802.11wâ”‚
â”‚ â€¢ HE40 mode   â”‚           â”‚ â€¢ HE80 mode       â”‚           â”‚ â€¢ EHT160 mode â”‚
â”‚ â€¢ No WPS      â”‚           â”‚ â€¢ No WPS          â”‚           â”‚ â€¢ No WPS      â”‚
â”‚ â€¢ KRACK fix   â”‚           â”‚ â€¢ KRACK fix       â”‚           â”‚ â€¢ WiFi 7      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                               â”‚                               â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â–¼
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚   Client Devices    â”‚
                            â”‚                     â”‚
                            â”‚ â€¢ Laptops           â”‚
                            â”‚ â€¢ Smartphones       â”‚
                            â”‚ â€¢ IoT devices       â”‚
                            â”‚ â€¢ Smart TVs         â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Security Layers

### Layer 1: Perimeter Defense (WAN)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ WAN Firewall                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ“ Default REJECT all incoming                         â”‚
â”‚ âœ“ SYN flood protection enabled                        â”‚
â”‚ âœ“ Invalid packet dropping                             â”‚
â”‚ âœ“ No ICMP redirects                                    â”‚
â”‚ âœ“ No source routing                                    â”‚
â”‚ âœ“ Reverse path filtering                              â”‚
â”‚ âœ“ Only WireGuard (51820/UDP) allowed from outside     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Layer 2: Threat Intelligence
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BanIP - Active Threat Blocking                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ“ Firehol Level 1, 2, 3 (known bad IPs)              â”‚
â”‚ âœ“ Spamhaus DROP/EDROP lists                           â”‚
â”‚ âœ“ Talos IP blacklist                                   â”‚
â”‚ âœ“ SSH brute force protection (3 attempts)             â”‚
â”‚ âœ“ Automatic log monitoring                            â”‚
â”‚ âœ“ Real-time updates from feeds                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Layer 3: Privacy & Content Filtering
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DNS-over-HTTPS                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ“ Encrypted DNS queries (TLS 1.3)                     â”‚
â”‚ âœ“ Primary: Cloudflare (1.1.1.1)                       â”‚
â”‚ âœ“ Backup: Quad9 (9.9.9.9)                             â”‚
â”‚ âœ“ Prevents DNS hijacking                              â”‚
â”‚ âœ“ Blocks ISP tracking                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Adblock                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ“ AdAway blocklist                                     â”‚
â”‚ âœ“ OISD domain list                                     â”‚
â”‚ âœ“ Steven Black unified list                           â”‚
â”‚ âœ“ Safe search enforcement                             â”‚
â”‚ âœ“ Tracker blocking                                     â”‚
â”‚ âœ“ Malware domain blocking                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Layer 4: Wireless Security
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ WPA3-SAE Encryption                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ“ Simultaneous Authentication of Equals (SAE)         â”‚
â”‚ âœ“ Forward secrecy (PFS)                               â”‚
â”‚ âœ“ Resistant to offline dictionary attacks             â”‚
â”‚ âœ“ Protected Management Frames (IEEE 802.11w)          â”‚
â”‚ âœ“ KRACK attack mitigation                             â”‚
â”‚ âœ“ WPS disabled (eliminates vulnerability)             â”‚
â”‚ âœ“ Strong PSK required                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Layer 5: Access Control
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SSH Hardening                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ“ Public key authentication only                      â”‚
â”‚ âœ“ Password authentication disabled                    â”‚
â”‚ âœ“ Root password login disabled                        â”‚
â”‚ âœ“ LAN-only access                                      â”‚
â”‚ âœ“ No gateway port forwarding                          â”‚
â”‚ âœ“ BanIP monitors for brute force                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Web Interface (LuCI)                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ“ HTTPS-only (TLS encryption)                         â”‚
â”‚ âœ“ HTTPâ†’HTTPS automatic redirect                       â”‚
â”‚ âœ“ LAN-only access                                      â”‚
â”‚ âœ“ Strong session management                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Layer 6: VPN Access
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ WireGuard VPN                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ“ ChaCha20-Poly1305 encryption                        â”‚
â”‚ âœ“ Curve25519 key exchange                             â”‚
â”‚ âœ“ Perfect forward secrecy                             â”‚
â”‚ âœ“ Fast handshake (1-RTT)                              â”‚
â”‚ âœ“ Isolated VPN firewall zone                          â”‚
â”‚ âœ“ NAT for VPN clients                                 â”‚
â”‚ âœ“ Port: 51820/UDP                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Layer 7: Kernel Hardening
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ System (sysctl) Parameters                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ“ TCP SYN cookies enabled                             â”‚
â”‚ âœ“ ICMP broadcast ignore                               â”‚
â”‚ âœ“ Bogus ICMP responses blocked                        â”‚
â”‚ âœ“ IP redirects disabled                               â”‚
â”‚ âœ“ Source routing disabled                             â”‚
â”‚ âœ“ Reverse path filtering enabled                      â”‚
â”‚ âœ“ Martian packet logging                              â”‚
â”‚ âœ“ Optimized TCP backlog (4096)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow

### Inbound Traffic (Internet â†’ Device)
```
Internet
  â”‚
  â”œâ”€â–º [WAN Firewall] â”€â”€â”€â”€â–º Block invalid/unsolicited
  â”‚                         â””â”€â–º REJECT most traffic
  â”‚
  â”œâ”€â–º [BanIP] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Check against threat feeds
  â”‚                         â””â”€â–º Block if on blacklist
  â”‚
  â”œâ”€â–º [WireGuard] â”€â”€â”€â”€â”€â”€â”€â”€â–º Only allow VPN traffic (51820/UDP)
  â”‚                         â””â”€â–º Decrypt & forward to LAN
  â”‚
  â””â”€â–º [Established] â”€â”€â”€â”€â”€â”€â–º Allow reply traffic only
```

### Outbound Traffic (Device â†’ Internet)
```
Device
  â”‚
  â”œâ”€â–º [LAN] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Client requests
  â”‚
  â”œâ”€â–º [DNS Query] â”€â”€â”€â”€â”€â”€â”€â”€â–º Intercept DNS
  â”‚     â”‚
  â”‚     â”œâ”€â–º [Adblock] â”€â”€â”€â–º Check blocklists
  â”‚     â”‚                  â””â”€â–º Return NXDOMAIN if blocked
  â”‚     â”‚
  â”‚     â””â”€â–º [DoH Proxy] â”€â–º Encrypt DNS via HTTPS
  â”‚                        â””â”€â–º Forward to Cloudflare/Quad9
  â”‚
  â”œâ”€â–º [Firewall] â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Apply egress rules
  â”‚
  â””â”€â–º [NAT] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Masquerade & forward to WAN
```

### Wireless Connection Flow
```
Client Device
  â”‚
  â”œâ”€â–º [WiFi Association] â”€â–º Request to connect
  â”‚
  â”œâ”€â–º [WPA3-SAE] â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Secure authentication
  â”‚     â”‚                   â€¢ Dragonfly handshake
  â”‚     â”‚                   â€¢ Forward secrecy
  â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Session keys established
  â”‚
  â”œâ”€â–º [802.11w] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Management frame protection
  â”‚                          â€¢ Prevents deauth attacks
  â”‚
  â”œâ”€â–º [DHCP] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Obtain IP address
  â”‚
  â””â”€â–º [Connected] â”€â”€â”€â”€â”€â”€â”€â”€â–º Secure traffic flow
```

## Security Monitoring

### Logging Points
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Security Event Sources                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ Firewall drops â†’ /var/log/messages                   â”‚
â”‚ â€¢ BanIP blocks â†’ /tmp/ban_data/banip.log              â”‚
â”‚ â€¢ SSH attempts â†’ syslog (monitored by BanIP)          â”‚
â”‚ â€¢ DNS queries â†’ dnsmasq log                            â”‚
â”‚ â€¢ System events â†’ logread                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Monitoring Commands
```bash
# View firewall drops in real-time
logread -f | grep -i "drop\|reject"

# Check BanIP status
/etc/init.d/banip status

# View blocked IPs
cat /tmp/ban_data/banip.list | wc -l

# Monitor active connections
netstat -tunap

# Check WireGuard status
wg show

# View DNS queries
logread | grep dnsmasq

# Check security script status
/root/security_check.sh
```

## Attack Mitigation Summary

| Attack Type | Mitigation | Layer |
|-------------|-----------|-------|
| Brute Force SSH | BanIP auto-blocking | 2 |
| DDoS/SYN Flood | SYN cookies, rate limiting | 1, 7 |
| DNS Spoofing | DNS-over-HTTPS | 3 |
| MITM WiFi | WPA3-SAE, 802.11w | 4 |
| KRACK Attack | WPA3 + EAPOL fixes | 4 |
| WPS Attacks | WPS disabled | 4 |
| Port Scanning | Default REJECT policy | 1 |
| IP Spoofing | Reverse path filtering | 7 |
| ICMP Redirects | Redirects disabled | 7 |
| Malware Domains | Adblock + threat feeds | 3 |
| Known Bad IPs | BanIP threat intel | 2 |
| Deauth Attack | 802.11w PMF | 4 |
| Password Guessing | Key-only SSH, WPA3 | 5 |

## Performance Metrics

### Expected Latency
```
DNS Query: +1-2ms (DoH overhead)
Firewall: <0.5ms (minimal)
BanIP Check: <0.1ms (in-memory)
WireGuard: +1-5ms (encryption)
Total Overhead: ~3-8ms typical
```

### Throughput Impact
```
Firewall: <1% (negligible)
DoH Proxy: <1% (minimal)
WireGuard: 2-5% (encryption overhead)
Adblock: <1% (DNS level)
Total: <5% on gigabit connections
```

### Resource Usage
```
CPU: 2-5% average load
RAM: 30-50MB for security features
Flash: 15-20MB for packages
```

## Security Posture Comparison

### Before Configuration
```
ğŸ”´ Firewall: Permissive
ğŸ”´ WiFi: WPA2 only
ğŸ”´ DNS: Plaintext, ISP visible
ğŸ”´ Threats: No blocking
ğŸ”´ SSH: Password-based
ğŸ”´ Web UI: HTTP
ğŸ”´ VPN: Not configured
ğŸ”´ Ads: No blocking

SECURITY SCORE: 3/10
```

### After Configuration
```
ğŸŸ¢ Firewall: Strict deny-all
ğŸŸ¢ WiFi: WPA3-SAE + 802.11w
ğŸŸ¢ DNS: Encrypted DoH
ğŸŸ¢ Threats: Active blocking
ğŸŸ¢ SSH: Key-only, LAN-only
ğŸŸ¢ Web UI: HTTPS-only
ğŸŸ¢ VPN: WireGuard ready
ğŸŸ¢ Ads: Multi-source blocking

SECURITY SCORE: 9.5/10
```

---

**Architecture Version**: 1.0.0
**Last Updated**: 2025-10-13
**Compatible with**: GL-BE9300 + OpenWRT 23.05+
